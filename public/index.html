<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Market Metrics</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #06080f; --surface: #0d1117; --border: #1c2333;
      --accent: #00e5a0; --accent2: #0070f3; --text: #e8eaf0;
      --muted: #5a6478; --nav-width: 240px;
    }

    html, body {
      height: 100%; background: var(--bg); color: var(--text);
      font-family: 'DM Mono', monospace; overflow-x: hidden;
    }

    .layout { display: flex; min-height: 100vh; }

    .nav {
      position: fixed; top: 0; right: 0;
      width: var(--nav-width); height: 100vh;
      background: var(--surface); border-left: 1px solid var(--border);
      display: flex; flex-direction: column; padding: 40px 0; z-index: 100;
    }

    .nav-label {
      font-size: 9px; letter-spacing: 0.25em; color: var(--muted);
      text-transform: uppercase; padding: 0 28px 20px;
      border-bottom: 1px solid var(--border); margin-bottom: 16px;
    }

    .nav-link {
      display: flex; align-items: center; gap: 12px;
      padding: 14px 28px; color: var(--muted); text-decoration: none;
      font-size: 12px; letter-spacing: 0.05em; font-weight: 500;
      transition: color 0.2s, background 0.2s; position: relative;
    }

    .nav-link::before {
      content: ''; position: absolute; left: 0; top: 0; bottom: 0;
      width: 2px; background: var(--accent);
      transform: scaleY(0); transition: transform 0.2s;
    }

    .nav-link:hover { color: var(--text); background: rgba(255,255,255,0.03); }
    .nav-link:hover::before { transform: scaleY(1); }
    .nav-link.active { color: var(--accent); background: rgba(0,229,160,0.06); }
    .nav-link.active::before { transform: scaleY(1); }

    .nav-dot {
      width: 6px; height: 6px; border-radius: 50%;
      background: currentColor; flex-shrink: 0;
    }

    .nav-link.active .nav-dot { box-shadow: 0 0 8px var(--accent); }

    .nav-footer {
      margin-top: auto; padding: 20px 28px 0;
      border-top: 1px solid var(--border);
      font-size: 9px; letter-spacing: 0.1em; color: var(--muted);
    }

    .main {
      flex: 1; margin-right: var(--nav-width);
      display: flex; flex-direction: column;
      min-height: 100vh; position: relative;
    }

    .main::before {
      content: ''; position: fixed; inset: 0; right: var(--nav-width);
      background-image:
        linear-gradient(rgba(0,229,160,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,229,160,0.03) 1px, transparent 1px);
      background-size: 60px 60px; pointer-events: none;
    }

    .main::after {
      content: ''; position: fixed; top: -200px; left: -200px;
      width: 600px; height: 600px;
      background: radial-gradient(circle, rgba(0,112,243,0.12) 0%, transparent 70%);
      pointer-events: none; animation: drift 12s ease-in-out infinite alternate;
    }

    @keyframes drift {
      from { transform: translate(0,0); } to { transform: translate(100px,80px); }
    }

    .header { padding: 60px 70px 0; position: relative; z-index: 1; }

    .ticker-bar {
      display: flex; gap: 28px; font-size: 10px;
      letter-spacing: 0.08em; color: var(--muted);
      margin-bottom: 60px; animation: fadeDown 0.6s ease both; flex-wrap: wrap;
    }

    .ticker-item { display: flex; gap: 6px; align-items: center; }
    .ticker-val { color: var(--text); }
    .up { color: var(--accent); }
    .down { color: #ff4d6d; }

    .hero { animation: fadeUp 0.8s ease both 0.1s; }

    .eyebrow {
      font-size: 10px; letter-spacing: 0.3em; color: var(--accent);
      text-transform: uppercase; margin-bottom: 20px;
    }

    h1 {
      font-family: 'DM Serif Display', serif;
      font-size: clamp(52px, 7vw, 100px);
      line-height: 1; letter-spacing: -0.02em; color: var(--text);
    }

    h1 em { font-style: italic; color: var(--accent); }

    .subtitle {
      font-size: 12px; color: var(--muted); letter-spacing: 0.06em;
      max-width: 400px; line-height: 1.8; margin-top: 20px;
    }

    .cards {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 1px; margin: 70px 70px 0;
      border: 1px solid var(--border); background: var(--border);
      position: relative; z-index: 1;
      animation: fadeUp 0.8s ease both 0.3s;
    }

    .card { background: var(--surface); padding: 32px 28px; transition: background 0.2s; }
    .card:hover { background: #111827; }

    .card-label {
      font-size: 9px; letter-spacing: 0.2em; color: var(--muted);
      text-transform: uppercase; margin-bottom: 14px;
    }

    .card-value {
      font-size: 28px; font-weight: 500; color: var(--text);
      letter-spacing: -0.02em; margin-bottom: 6px;
    }

    .card-change { font-size: 11px; letter-spacing: 0.04em; }

    .sparkline-section {
      margin: 1px 70px 0; background: var(--surface);
      border: 1px solid var(--border); border-top: none;
      padding: 24px 28px; position: relative; z-index: 1;
      animation: fadeUp 0.8s ease both 0.45s;
    }

    .sparkline-label {
      font-size: 9px; letter-spacing: 0.2em; color: var(--muted);
      text-transform: uppercase; margin-bottom: 16px;
    }

    svg.spark { width: 100%; height: 60px; overflow: visible; }
    .spark-path { fill: none; stroke: var(--accent); stroke-width: 1.5; stroke-linejoin: round; }
    .spark-fill { fill: url(#sparkGrad); }

    .cta-row {
      display: flex; gap: 16px; margin: 48px 70px 60px;
      position: relative; z-index: 1;
      animation: fadeUp 0.8s ease both 0.55s;
    }

    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 12px 24px; font-family: 'DM Mono', monospace;
      font-size: 11px; letter-spacing: 0.1em; text-transform: uppercase;
      cursor: pointer; border: none; text-decoration: none; transition: all 0.2s;
    }

    .btn-primary { background: var(--accent); color: #06080f; font-weight: 500; }
    .btn-primary:hover {
      background: #00ffb3; transform: translateY(-1px);
      box-shadow: 0 8px 24px rgba(0,229,160,0.25);
    }

    .btn-ghost { background: transparent; color: var(--muted); border: 1px solid var(--border); }
    .btn-ghost:hover { color: var(--text); border-color: var(--muted); }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeDown {
      from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); }
    }

    .pulse {
      display: inline-block; width: 7px; height: 7px; border-radius: 50%;
      background: var(--accent); margin-right: 6px; animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(0,229,160,0.5); }
      50% { box-shadow: 0 0 0 5px rgba(0,229,160,0); }
    }

    .skeleton {
      background: linear-gradient(90deg, var(--border) 25%, #1e2a3a 50%, var(--border) 75%);
      background-size: 200% 100%; animation: shimmer 1.5s infinite;
      border-radius: 2px; display: inline-block;
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; } 100% { background-position: -200% 0; }
    }

    .error-msg { font-size: 10px; color: #ff4d6d; letter-spacing: 0.1em; padding: 4px 0; }
  </style>
</head>
<body>
<div class="layout">
  <main class="main">
    <div class="header">

      <div class="ticker-bar" id="tickerBar">
        <span class="ticker-item"><span class="pulse"></span><span style="letter-spacing:.15em">LIVE</span></span>
        <span class="ticker-item skeleton" style="width:120px;height:14px"></span>
        <span class="ticker-item skeleton" style="width:120px;height:14px"></span>
        <span class="ticker-item skeleton" style="width:100px;height:14px"></span>
        <span class="ticker-item skeleton" style="width:100px;height:14px"></span>
      </div>

      <div class="hero">
        <p class="eyebrow">// market intelligence dashboard</p>
        <h1>Market<br /><em>Metrics</em></h1>
        <p class="subtitle">Real-time data, analytical depth, and market signals — built for traders who need clarity under pressure.</p>
      </div>
    </div>

    <div class="cards">
      <div class="card">
        <div class="card-label">S&amp;P 500</div>
        <div class="card-value" id="spPrice"><span class="skeleton" style="width:120px;height:28px"></span></div>
        <div class="card-change" id="spChange">&nbsp;</div>
      </div>
      <div class="card">
        <div class="card-label">NASDAQ</div>
        <div class="card-value" id="nasdaqPrice"><span class="skeleton" style="width:120px;height:28px"></span></div>
        <div class="card-change" id="nasdaqChange">&nbsp;</div>
      </div>
      <div class="card">
        <div class="card-label">DOW JONES</div>
        <div class="card-value" id="dowPrice"><span class="skeleton" style="width:120px;height:28px"></span></div>
        <div class="card-change" id="dowChange">&nbsp;</div>
      </div>
    </div>

    <div class="sparkline-section">
      <div class="sparkline-label">S&amp;P 500 — intraday</div>
      <svg class="spark" id="sparkSvg" viewBox="0 0 800 60" preserveAspectRatio="none">
        <defs>
          <linearGradient id="sparkGrad" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="#00e5a0" stop-opacity="0.2"/>
            <stop offset="100%" stop-color="#00e5a0" stop-opacity="0"/>
          </linearGradient>
        </defs>
        <polygon id="sparkFill" class="spark-fill" points=""/>
        <polyline id="sparkLine" class="spark-path" points=""/>
      </svg>
    </div>

    <div class="cta-row">
      <a class="btn btn-primary" href="live-stock-metrics.html">→ Live Stock Metrics</a>
      <a class="btn btn-ghost" href="sp500.html">S&amp;P 500 Overview</a>
    </div>
  </main>

  <nav class="nav">
    <div class="nav-label">Pages</div>
    <a class="nav-link active" href="index.html"><span class="nav-dot"></span>Home</a>
    <a class="nav-link" href="live-stock-metrics.html"><span class="nav-dot"></span>Live Stock Metrics</a>
    <a class="nav-link" href="sp500.html"><span class="nav-dot"></span>S&amp;P 500</a>
    <div class="nav-footer">Market Metrics © 2026</div>
  </nav>
</div>

<script>
  const API = 'http://localhost:3000/api';

  function fmt(n) {
    return n?.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) ?? '—';
  }

  function fmtPct(n) {
    return n != null ? `${n >= 0 ? '▲ +' : '▼ '}${Math.abs(n).toFixed(2)}%` : '—';
  }

  async function loadMarketSummary() {
    try {
      const res = await fetch(`${API}/market-summary`);
      const data = await res.json();
      const quotes = data?.quoteResponse?.result ?? [];

      const sp = quotes.find(q => q.symbol === '^GSPC');
      const nasdaq = quotes.find(q => q.symbol === '^IXIC');
      const dow = quotes.find(q => q.symbol === '^DJI');
      const vix = quotes.find(q => q.symbol === '^VIX');
      const dxy = quotes.find(q => q.symbol === 'DX-Y.NYB');

      if (sp) {
        document.getElementById('spPrice').textContent = fmt(sp.regularMarketPrice);
        const spCh = document.getElementById('spChange');
        spCh.textContent = fmtPct(sp.regularMarketChangePercent);
        spCh.className = 'card-change ' + (sp.regularMarketChangePercent >= 0 ? 'up' : 'down');
      }
      if (nasdaq) {
        document.getElementById('nasdaqPrice').textContent = fmt(nasdaq.regularMarketPrice);
        const nCh = document.getElementById('nasdaqChange');
        nCh.textContent = fmtPct(nasdaq.regularMarketChangePercent);
        nCh.className = 'card-change ' + (nasdaq.regularMarketChangePercent >= 0 ? 'up' : 'down');
      }
      if (dow) {
        document.getElementById('dowPrice').textContent = fmt(dow.regularMarketPrice);
        const dCh = document.getElementById('dowChange');
        dCh.textContent = fmtPct(dow.regularMarketChangePercent);
        dCh.className = 'card-change ' + (dow.regularMarketChangePercent >= 0 ? 'up' : 'down');
      }

      const items = [
        sp     && { label: 'SPY', val: fmt(sp.regularMarketPrice),     pct: sp.regularMarketChangePercent },
        nasdaq && { label: 'QQQ', val: fmt(nasdaq.regularMarketPrice), pct: nasdaq.regularMarketChangePercent },
        vix    && { label: 'VIX', val: fmt(vix.regularMarketPrice),    pct: vix.regularMarketChangePercent },
        dxy    && { label: 'DXY', val: fmt(dxy.regularMarketPrice),    pct: dxy.regularMarketChangePercent },
      ].filter(Boolean);

      document.getElementById('tickerBar').innerHTML =
        `<span class="ticker-item"><span class="pulse"></span><span style="letter-spacing:.15em">LIVE</span></span>` +
        items.map(i => `
          <span class="ticker-item">
            ${i.label} <span class="ticker-val">${i.val}</span>
            <span class="${i.pct >= 0 ? 'up' : 'down'}">${i.pct >= 0 ? '+' : ''}${i.pct?.toFixed(2)}%</span>
          </span>`).join('');

    } catch (err) {
      console.error('Failed to load market summary:', err);
      document.getElementById('tickerBar').innerHTML =
        `<span class="ticker-item"><span class="pulse"></span>LIVE</span>
         <span class="error-msg">Could not reach server — is it running on port 3000?</span>`;
    }
  }

  async function loadSparkline() {
    try {
      const res = await fetch(`${API}/chart?symbol=%5EGSPC&range=1d&interval=5m`);
      const data = await res.json();
      const closes = data?.chart?.result?.[0]?.indicators?.quote?.[0]?.close ?? [];
      const prices = closes.filter(p => p != null);
      if (!prices.length) return;

      const min = Math.min(...prices);
      const max = Math.max(...prices);
      const range = max - min || 1;
      const W = 800, H = 60;

      const coords = prices.map((p, i) => {
        const x = (i / (prices.length - 1)) * W;
        const y = H - ((p - min) / range) * H * 0.9 - H * 0.05;
        return `${x},${y}`;
      });

      document.getElementById('sparkLine').setAttribute('points', coords.join(' '));
      document.getElementById('sparkFill').setAttribute('points',
        `0,${H} ${coords.join(' ')} ${W},${H}`);
    } catch (err) {
      console.error('Sparkline error:', err);
    }
  }

  loadMarketSummary();
  loadSparkline();
  setInterval(loadMarketSummary, 60000);
  setInterval(loadSparkline, 60000);
</script>
</body>
</html>
